const J=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function n(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerpolicy&&(d.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?d.credentials="include":s.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(s){if(s.ep)return;s.ep=!0;const d=n(s);fetch(s.href,d)}};J();var M=(t,r,n)=>{if(!r.has(t))throw TypeError("Cannot "+n)},o=(t,r,n)=>(M(t,r,"read from private field"),n?n.call(t):r.get(t)),w=(t,r,n)=>{if(r.has(t))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(t):r.set(t,n)},h=(t,r,n,i)=>(M(t,r,"write to private field"),i?i.call(t,n):r.set(t,n),n),Q=(t,r,n)=>(M(t,r,"access private method"),n),m,D,a,c,P,p,x,F,H,I,R;const S=(t,r,n)=>{const i=r[t]||n;return i?(i(),!0):!1},ee=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],oe=[60,126,231,195,195,195,195,231,126,60,24,56,88,24,24,24,24,24,24,60,62,127,195,6,12,24,48,96,255,255,60,126,195,3,14,14,3,195,126,60,6,14,30,54,102,198,255,255,6,6,255,255,192,192,252,254,3,195,126,60,62,124,192,192,252,254,195,195,126,60,255,255,3,6,12,24,48,96,96,96,60,126,195,195,126,126,195,195,126,60,60,126,195,195,127,63,3,3,62,124];class j{constructor(r){this.instruction=r,this.kk=r&255,this.n=r&15,this.nnn=r&4095,this.opcode=r&61440,this.x=(r&3840)>>8,this.y=(r&240)>>4}}const N=class{constructor(t){w(this,F),w(this,I),w(this,m,new Uint8Array(4*1024)),w(this,D,[]),w(this,a,new Uint8Array(16)),w(this,c,N.START_ADDRESS),w(this,P,new Uint8Array(16)),w(this,p,0),w(this,x,0),this.soundTimer=0,this.running=!0,this.drawFlag=!1,this.c8=t,this.reset()}loadRom(t){for(let r=0;r<t.length;r++){const n=r+N.START_ADDRESS;if(n<o(this,m).length)o(this,m)[n]=t[r];else throw new Error("ROM too large")}}reset(){o(this,m).fill(0);for(const[t,r]of ee.entries())o(this,m)[t]=r;for(const[t,r]of oe.entries())o(this,m)[N.LARGE_FONT_BASE+t]=r;h(this,D,[]),o(this,a).fill(0),h(this,c,N.START_ADDRESS),o(this,P).fill(0),h(this,p,0),h(this,x,0),this.soundTimer=0,this.drawFlag=!1,this.running=!0}fetch(){const t=o(this,m)[o(this,c)],r=o(this,m)[o(this,c)+1];return h(this,c,o(this,c)+2),t<<8|r}decode(t){return new j(t)}decodeAndExecute(t){const r=new j(t),{opcode:n,x:i,y:s,n:d,kk:v,nnn:A}=r,e=Q(this,F,H).call(this,r);S(n,{0:()=>S(s,{1:e.EXIT_N,12:e.S8_SCD_N})||S(v,{224:e.CLS,238:e.RET,250:e.COMPAT,251:e.S8_SCR,252:e.S8_SCL,253:e.S8_EXIT,254:e.S8_LOW,255:e.S8_HIGH})||e.CALL_NNN(),4096:e.JMP_NNN,8192:e.CALL_NNN_2,12288:e.SE_VX_NN,16384:e.SNE_VX_NN,20480:e.SE_VX_VY,24576:e.LD_VX_NN,28672:e.ADD_VX_NN,32768:()=>S(d,{0:e.LD_VX_VY,1:e.OR_VX_VY,2:e.AND_VX_VY,3:e.XOR_VX_VY,4:e.ADD_VX_VY,5:e.SUB_VX_VY,6:e.SHR_VX_VY,7:e.SUBN_VY_VX,14:e.SHL_VX_VY}),36864:e.SNE_VX_VY,40960:e.LD_I_NNN,45056:e.JP_V0_NNN,49152:e.RND_VX_NN,53248:()=>this.c8.highRes&&d===0?e.S8_DRW_VX_VX_0():e.DRW_VX_VX_N(),57344:()=>S(v,{158:e.SKP_VX,161:e.SKNP_VX}),61440:()=>S(v,{7:e.LD_VX_DT,10:e.LD_VX_KEY,21:e.LD_DT_VX,24:e.LD_ST_VX,30:e.ADD_I_VX,41:e.LD_I_FONT_VX,48:e.S8_LD_I_FONT_VX,51:e.BCD_VX,85:e.LD_I_VX,101:e.LD_VX_I,117:e.LD_R_VX,133:e.LD_VX_R})})}cycle(){const t=this.fetch();this.decodeAndExecute(t)}ticker(){o(this,x)>0&&h(this,x,o(this,x)-1),this.soundTimer>0&&(this.soundTimer-=1)}};let V=N;m=new WeakMap;D=new WeakMap;a=new WeakMap;c=new WeakMap;P=new WeakMap;p=new WeakMap;x=new WeakMap;F=new WeakSet;H=function(t){const{instruction:r,opcode:n,x:i,y:s,n:d,kk:v,nnn:A}=t;return{EXIT_N:()=>{const e=new Error(`Exit with return value ${d}`);throw e.name="QUIT",e.code=d,e},S8_SCD_N:()=>{for(let e=this.c8.display.rows-1;e>=d;e--)for(let l=0;l<this.c8.display.columns;l++)this.c8.display.setPixel(l,e,this.c8.display.getPixel(l,e-d));for(let e=0;e<d;e++)for(let l=0;l<this.c8.display.columns;l++)this.c8.display.setPixel(l,e,0);this.drawFlag=!0},CLS:()=>{this.c8.display.clear(),this.drawFlag=!0},RET:()=>{h(this,c,o(this,D).pop())},COMPAT:()=>{console.warn("[COMPAT]","Not implemented")},S8_SCR:()=>{for(let e=0;e<this.c8.display.rows;e++){let l=0;for(l=this.c8.display.columns-1;l>=4;l--)this.c8.display.setPixel(l-4,e,this.c8.display.getPixel(l,e));this.c8.display.setPixel(l,e,0),this.c8.display.setPixel(l-1,e,0),this.c8.display.setPixel(l-2,e,0),this.c8.display.setPixel(l-3,e,0)}this.drawFlag=!0},S8_SCL:()=>{for(let e=0;e<this.c8.display.rows;e++){let l=0;for(l=0;l<this.c8.display.columns-4;l++)this.c8.display.setPixel(l,e,this.c8.display.getPixel(l+4,e));this.c8.display.setPixel(l,e,0),this.c8.display.setPixel(l+1,e,0),this.c8.display.setPixel(l+2,e,0),this.c8.display.setPixel(l+3,e,0)}this.drawFlag=!0},S8_EXIT:()=>{this.running=!1},S8_LOW:()=>{this.c8.changeMode(!1)},S8_HIGH:()=>{this.c8.changeMode(!0)},CALL_NNN:()=>{h(this,c,o(this,c)+2&4095)},JMP_NNN:()=>{h(this,c,A)},CALL_NNN_2:()=>{o(this,D).push(o(this,c)),h(this,c,A)},SE_VX_NN:()=>{o(this,a)[i]===v&&h(this,c,o(this,c)+2)},SNE_VX_NN:()=>{o(this,a)[i]!==v&&h(this,c,o(this,c)+2)},SE_VX_VY:()=>{o(this,a)[i]===o(this,a)[s]&&h(this,c,o(this,c)+2)},LD_VX_NN:()=>{o(this,a)[i]=v},ADD_VX_NN:()=>{o(this,a)[i]+=v,o(this,a)[i]&=255},LD_VX_VY:()=>{o(this,a)[i]=o(this,a)[s]},OR_VX_VY:()=>{o(this,a)[i]|=o(this,a)[s]},AND_VX_VY:()=>{o(this,a)[i]&=o(this,a)[s]},XOR_VX_VY:()=>{o(this,a)[i]^=o(this,a)[s]},ADD_VX_VY:()=>{const e=o(this,a)[i]+o(this,a)[s];o(this,a)[15]=e>255?1:0,o(this,a)[i]=e&255},SUB_VX_VY:()=>{const e=o(this,a)[i]-o(this,a)[s];o(this,a)[15]=e<0?0:1,o(this,a)[i]=e&255},SHR_VX_VY:()=>{o(this,a)[15]=o(this,a)[i]&1,o(this,a)[i]=o(this,a)[i]>>1},SUBN_VY_VX:()=>{o(this,a)[15]=o(this,a)[i]<o(this,a)[s]?1:0,o(this,a)[i]=o(this,a)[s]-o(this,a)[i],o(this,a)[i]&=255},SHL_VX_VY:()=>{o(this,a)[15]=o(this,a)[i]>>7&1,o(this,a)[i]=o(this,a)[i]<<1,o(this,a)[i]=o(this,a)[i]&255},SNE_VX_VY:()=>{o(this,a)[i]!==o(this,a)[s]&&h(this,c,o(this,c)+2)},LD_I_NNN:()=>{h(this,p,A)},JP_V0_NNN:()=>{h(this,c,A+o(this,a)[0])},RND_VX_NN:()=>{o(this,a)[i]=Math.floor(Math.random()*255)&v},S8_DRW_VX_VX_0:()=>{o(this,a)[15]=0;const e=o(this,a)[i],l=o(this,a)[s];for(let b=0;b<16&&!(l+b>=this.c8.display.rows);b++){let C=o(this,m)[o(this,p)+b*2],B=o(this,m)[o(this,p)+(b*2+1)];for(let u=0;u<16;u++){if(e+u>=this.c8.display.columns)continue;let _=u<8?C>>7-u&1:B>>15-u&1,T=this.c8.display.getPixel(e+u,l+b);if(_===1&&T){o(this,a)[15]=1,this.c8.display.setPixel(e+u,l+b,0);continue}_===1&&!T&&this.c8.display.setPixel(e+u,l+b,1)}}this.drawFlag=!0},DRW_VX_VX_N:()=>{o(this,a)[15]=0;const e=o(this,a)[i],l=o(this,a)[s],b=d;for(let C=0;C<b;C++){const B=o(this,m)[o(this,p)+C];for(let u=0;u<8;u++){const _=e+u,T=l+C;if(_<this.c8.display.columns&&T<this.c8.display.rows){const Y=B>>7-u&1,U=this.c8.display.getPixel(_,T);(U&Y)===1&&(o(this,a)[15]=1),this.c8.display.setPixel(_,T,U^Y)}}}this.drawFlag=!0},SKP_VX:()=>{o(this,I,R)[o(this,a)[i]]&&h(this,c,o(this,c)+2)},SKNP_VX:()=>{o(this,I,R)[o(this,a)[i]]||h(this,c,o(this,c)+2)},LD_VX_DT:()=>{o(this,a)[i]=o(this,x)},LD_VX_KEY:()=>{let e=!1;for(const[l,b]of o(this,I,R).entries())if(b){o(this,a)[i]=l,e=!0;break}e||h(this,c,o(this,c)-2)},LD_DT_VX:()=>{h(this,x,o(this,a)[i])},LD_ST_VX:()=>{this.soundTimer=o(this,a)[i]},ADD_I_VX:()=>{const e=o(this,p)+o(this,a)[i];o(this,a)[15]=e>4095?1:0,h(this,p,e&4095)},LD_I_FONT_VX:()=>{h(this,p,o(this,a)[i]*5)},S8_LD_I_FONT_VX:()=>{const e=o(this,a)[i]*10;h(this,p,N.LARGE_FONT_BASE+e&4095)},BCD_VX:()=>{o(this,m)[o(this,p)]=Math.floor(o(this,a)[i]/100),o(this,m)[o(this,p)+1]=Math.floor(o(this,a)[i]%100/10),o(this,m)[o(this,p)+2]=o(this,a)[i]%100%10},LD_I_VX:()=>{for(let e=0;e<=i;e++)o(this,m)[o(this,p)+e]=o(this,a)[e]},LD_VX_I:()=>{for(let e=0;e<=i;e++)o(this,a)[e]=o(this,m)[o(this,p)+e]},LD_R_VX:()=>{for(let e=0;e<=i;e++)o(this,P)[e]=o(this,a)[e]},LD_VX_R:()=>{for(let e=0;e<=i;e++)o(this,a)[e]=o(this,a)[e]}}};I=new WeakSet;R=function(){return this.c8.keyboard.keysBuff};V.START_ADDRESS=512;V.FONT_BASE=80;V.LARGE_FONT_BASE=80+80;class re{constructor(){this.rows=64,this.columns=128,this.resolution=0,this.bitMap=[],this.resolution=this.rows*this.columns,this.bitMap=new Array(this.resolution).fill(0)}clear(){this.bitMap.fill(0)}setPixel(r,n,i){const s=this.getIndex(r,n);this.bitMap[s]=i}getPixel(r,n){return this.bitMap[this.getIndex(r,n)]}getIndex(r,n){return n*this.columns+r}}const X={1:1,2:2,3:3,4:12,q:4,w:5,e:6,r:13,a:7,s:8,d:9,f:14,z:10,x:0,c:11,v:15};class te{constructor(){this.KEY_MAP=X,this.keysBuff=new Uint8Array(16)}keyDown(r){r=r.toLowerCase();const n=X[r];return typeof n!="undefined"?(this.keysBuff[n]=1,!0):!1}keyUp(r){r=r.toLowerCase();const n=X[r];return typeof n!="undefined"?(this.keysBuff[n]=0,!0):!1}reset(){this.keysBuff.fill(0)}}class ae{constructor(){this.RATE=0,this.highRes=!1,this.cpu=new V(this),this.display=new re,this.keyboard=new te,this.changeMode(!1)}changeMode(r){this.highRes=r,this.RATE=r?700:480}reset(){this.highRes=!1,this.cpu.reset(),this.display.clear(),this.keyboard.reset()}loadRom(r){this.cpu.loadRom(r)}toggleRunning(){return this.cpu.running=!this.cpu.running,this.cpu.running}}function ie(){return new ae}const G=(t,r="ch8")=>`/roms/schip8/${t}.${r}`,q=(t,r="ch8")=>`/roms/chip8/${t}.${r}`,k=(t,r=!0)=>`<a target="target" href="${(r?G:q)(t,"txt")}">${t}.txt</a>`,W=[{name:"ALIEN",desc:"A Space Invaders clone. Start/Shoot with A, Move with 3 and C.  *NOTEA->5 3->4 C->6",sc8:!0},{name:"ANT",desc:"A Mariobross clone... Move with 3 & C, jump with A.  *NOTE3->4 C->6 A->5",sc8:!0},{name:"BLINKY",desc:"A PACMAN clone. Eat the gums in the maze. Avoid being eaten by the enemies. Move with 7/8 (left/right) and 3/6 (up/down). 1 goes to  next level, F skips pause.          *NOTEsame as CHIP-8 blinky",sc8:!0},{name:"CAR",desc:"A car game. Move with 7 and 8s.  *NOTE7->4 8->6",sc8:!0},{name:"DRAGON1",desc:`See ${k("DRAGON")}`,sc8:!0},{name:"DRAGON2",desc:`See ${k("DRAGON")}`,sc8:!0},{name:"FIELD",desc:'See <a target="target" href="/roms/schip8/FIELD.txt">FIELD.txt</a>',sc8:!0},{name:"HPIPER",desc:`A Pipe-mania clone. Move using 7/8 3/6. Place a pipe using 4 or 1. See ${k("HPIPER")}. *NOTE7->4 8->6 3->2 6->8 4->5`,sc8:!0},{name:"JOUST23",desc:`See ${k("JOUST23")} (A = start/up, 3/C = left/right)  *NOTEA->5 3->4 C->6`,sc8:!0},{name:"LASER",desc:"Shoot the opponent using your laser gun. E=start 1P game,  F=start 2P game, player 11/4=up/down, 2=fire.  player 2C/D=up/down, 3=fire.",sc8:!0},{name:"MATCHES",desc:"This is a two-player game. Select the number of matches with 1/2/3,          then each player removes 1, 2, or 3 matches using 4/5/6 (player 1)          or 7/8/9 (player 2). The one who gets the last match wins.",sc8:!0},{name:"MAZE",desc:"This little program draws random mazes.",sc8:!0},{name:"MINES",desc:`See ${k("MINES")} (2 4 6 8 to move, 5 to show square, C to mark)`,sc8:!0},{name:"RACE",desc:"A car game. Move with 7 and 8.  *NOTE7->4 8->6",sc8:!0},{name:"SPACEFIG",desc:`See ${k("SPACEFIG")} (A=start/fire, 3/C=left/right)  *NOTEA->5 3->4 C->6`,sc8:!0},{name:"SQUARE",desc:`See ${k("SQUARE")} (2 4 6 8 to move, 5 to select)`,sc8:!0},{name:"UBOAT",desc:`See ${k("UBOAT")} (7/8/9 to stop/half speef/full speed,  E to drop depth charge, C to abort game)          *NOTE7/8/9->4/5/6, E->8 C->2`,sc8:!0},{name:"WORM3",desc:"Like SYZYGY, you're a snake. You have to eat the eggs which appear a random locations on the screen. As you eat, you grow... Avoid eating yourself or crashing on the extremities of the screen. To turn 90 left, press 8. Press 9 to turn 90 right.  *NOTE2->4 9->6",sc8:!0},{name:"TEST/BMPviewer",desc:"Draw a bitmap picture.",sc8:!0},{name:"TEST/Emutest",desc:"Test the SCHIP half-line scrolling.",sc8:!0},{name:"TEST/HEX_MIXT",desc:"Draws random characters, and beeps a lot.",sc8:!0},{name:"TEST/LINEDEMO",desc:"Draw lines.",sc8:!0},{name:"TEST/ROBOT",desc:"???",sc8:!0},{name:"TEST/SCR_TEST",desc:"Test display capabilities.",sc8:!0},{name:"TEST/TEST",desc:"A little program to show some basic functions of the super-chip          instructions. Not interesting.",sc8:!0},{name:"TEST/TEST_128",desc:"Idem.",sc8:!0},{name:"TEST/WORMS",desc:"Draw random worms.",sc8:!0},{name:"15PUZZLE",desc:"You have to move all the items and put them in increasing order,          starting at the upper-left corner. Move the item you want by          pressing his associated key (exto move item 3, press 3).          WARNINGuses the original CHIP8 keyboard, so you may have several          confusions."},{name:"AIRPLANE",desc:"You must drop packets from your airplane (key 8) and make sure          they hit the ground without colliding with other planes."},{name:"BLINKY",desc:"This game is a PACMAN clone. Your goal is to eat all the balls in          the maze. There are some enemies, so be careful. Use 2 4 6 and 8          to move.          *NOTEreally use 3/6 to go up/down, 7/8 to go left/right, and  F to restart the game. HAS TO BE CHANGED."},{name:"BLITZ",desc:"This game is a BOMBER clone. You are in a plane, and you must          destroy the towers of a town. Your plane is flying left to right,          and goes down. Use 5 to drop a bomb. The game ends when you crash          yourself on a tower..."},{name:"BREAKOUT",desc:"Same than BRIX, but has graphics looking like the game on the          Atari 2600 console."},{name:"BRIX",desc:'This game is an "arkanoid" precursor. You have 5 lives, and your          goal is the destruction of all the brixs. Use 4 and 6 to move          your paddle. The game ends when all the brixs are destroyed.'},{name:"CAVE",desc:"Type F to start, then use 2 4 6 8 to move through the CAVE without          hitting the walls."},{name:"CONNECT4",desc:"This game is for two players. The goal is to align 4 coins in the          game area. Each player's coins are colored. When you drop a coin,          it is paced on the latest dropped coin in the same column, or at          the bottom if the column is empty. Once the column is full, you          cannot place any more coins in it. To select a column, use 4 and 6.          To drop a coin, use 5. There is no winner detection yet. This will          be soon avalaible (Hey! I don't spend my life on CHIP8 !)."},{name:"FIGURES",desc:"Kind of Tetris with numbers. Use 4 and 6 to move, and 2 do do          something I didn't get."},{name:"FILTER",desc:"Catch everything that falls. Use 4 and 6 to move."},{name:"GUESS",desc:"Think to a number between 1 and 63. CHIP8 shows you several boards          and you have to tell if you see your number in them. Press 5 if so,          or another key if not. CHIP8 gives you the number..."},{name:"HIDDEN",desc:`See ${k("HIDDEN")} (use 2 4 6 8 to move, 5 to pick)`},{name:"INVADERS",desc:"The well known game. Destroy the invaders with your ship. Shoot with 5, move with 4 and 6. Press 5 to begin a game."},{name:"LANDING",desc:"Try to flatten the field for landing (?). Key 9 drops a bomb."},{name:"KALEID",desc:"A little program (not a game) to make funny graphics. Move around the screen with 2 4 6 8. To finish and make CHIP8 repeat your          moves, press 0."},{name:"MAZE",desc:"This little program draws random mazes."},{name:"MERLIN",desc:"This is the SIMON game. The goal is to remember in which order the          squares are lighted. The game begins by lighting 4 random squares,          and then asks you to light the squares in the correct order.          You win a level when you give the exact order, and each increasing          level shows a additionnal square. The game ends when you light an          incorrect square. Keys are 4 and 5 for the two upper squares, then          7 and 8 for the two other ones.  *NOTE5->2 8->6 7->8"},{name:"MISSILE",desc:"You must shoot the 8 targets on the screen using key 8. Your  shooter moves a little bit faster each time you shoot. You  have 12 missiles to shoot all the targets, and you win 5  points per target shot."},{name:"PADDLES",desc:"F=1P game, E=2Pgame 7/9=P1 left/right, 4/6=P2 left/right."},{name:"PONG(1P)",desc:"1-player pong, play against the computer. 1/4=up/down."},{name:"PONG (2)",desc:"Here is the well known pong game. Two versions are available.          The only difference is that PONG2 is mostly like the original          game. Player 1 uses 1 and 4, player 2 uses C and D."},{name:"PUZZLE",desc:"Same than PUZZLE2. Wait for randomization... Instead of moving the          item by pressing his associated key, move it UP DOWN LEFT RIGHT          with respectively 2 8 4 6. Up and Down are inverted as the game          uses the original CHIP8 keyboard.  *NOTEmust exchange up and down keys."},{name:"ROCKET",desc:"Follow the tunnel. B=start, 4/6=left/right.  *NOTEB->5"},{name:"SOCCER",desc:"Pong-like. 1/4=P1 up/down, C/D=P2 up/down."},{name:"SPACEF",desc:"Fly through the screen 3 times to win the level.  F=start, E=start level, 1/4=up/down  *NOTEF->5 E->6"},{name:"SQUASH",desc:"Exactely same than WALL, except that you have 5 balls, which are          not to be lost...  *NOTE1->2 4->6"},{name:"SYZYGY",desc:'This game is a SNAFU, or TRON variant. You are a snake, and you are very hungry. So, you eat the "0" which appears on the screen. Each time you eat, your size and score increase. You can choose to play with or without a border by pressing F or E before playing. Use 7 8 3 6 to move respectively LEFT RIGHT UP DOWN. When finished, press B to see the score.  *NOTEchange E/F->2/8 3/6->2/8 7/8->4/6 B->5'},{name:"TANK",desc:"You are in a tank which has 25 bombs. Your goal is to hit 25 times          a mobile target. The game ends when all your bombs are shot.          If your tank hits the target, you lose 5 bombs. Use 2 4 6 and 8 to          move. This game uses the original CHIP8 keyboard, so directions 2          and 8 are swapped.  *NOTEexchange 2/8"},{name:"TETRIS",desc:"Guess what this game is... I'm sure you don't need the rules. If          you do, please ask your friends. Use 4 to rotate, 5 and 6 to move,          1 to drop a piece.  *NOTE4->5 5->4 1->8"},{name:"TICTAC",desc:"A TIC-TAC-TOE game. Play with [1] to [9] keys. Each key corresponds          to a square in the grid. The game never ends, so at any time, the          winner is the one who has the best score."},{name:"TRON",desc:"B=with borders. F=without borders. 0=start. Player 11/4 3/C.  Player 27/A 9/E."},{name:"UFO",desc:"A precursor of INVADERS. You have 15 missiles to shoot on the two          invaders. The big one moves on the left and gives you 5 points.          The small one moves on the right at variant speeds. You can shoot          them in three directionsleft, up and right. Use 4 to shoot on the          left, 5 to shoot up, 6 to shoot on the right. The game ends after          having shot the 15 missiles."},{name:"VBRIX",desc:"Like BRIX, but the brix are put vertically, and the pad also moves          vertically. Start by pressing 7, and move using 4 and 1.  *NOTE7->5 1->2 4->6"},{name:"VERS",desc:"A TRON clone. Keys                                  Left Pl.   Right Pl.                          UP          7          C                          DOWN        A          D                          LEFT        1          B                          RIGHT       2          F"},{name:"WALL",desc:'One of these PONG variations. Move using 1 and 4. As said in the          early seventies"AVOID MISSING BALL FOR HIGH SCORE" !!!  *NOTE1->2 4->6'},{name:"WIPEOFF",desc:"Another BRIX variant, but quite hard to play. Move with 4 and 6.          Your score is shown when you lose all your lives."},{name:"TEST/C8PIC",desc:"Display the word CHIP8."},{name:"TEST/IBM",desc:"Display an IBM logo."},{name:"TEST/ROCKET2",desc:"Small animation. F=start.  *NOTEF->5"},{name:"TEST/TAPEWORM",desc:"Make a very long snake. F=start, 2 4 6 8=turn.  *NOTEF->5"},{name:"TEST/TIMEBOMB",desc:"Chronometer. 2/8Set time. 5Start."},{name:"TEST/X-MIRROR",desc:"Draws symmetric patterns using 2 4 6 8."}];async function ne(t){return await fetch(t.sc8?G(t.name):q(t.name)).then(r=>r.arrayBuffer()).then(r=>new Uint8Array(r))}const E=t=>document.getElementById(t),g=ie();window.chip8=g;E("footerYear").innerHTML=new Date().getFullYear().toString();const y=E("gameGrid");y.width=640;y.height=320;const z=y.getContext("2d");z.fillStyle="#000";z.fillRect(0,0,y.width,y.height);const L=E("keys"),le=E("audio"),O=E("rom");O.innerHTML=W.map((t,r)=>`<option value="${r}">${t.name}${t.sc8?"(SC8)":""}</option>`).join("");O.value="3";const se=Object.entries(g.keyboard.KEY_MAP);L.innerHTML=se.map(t=>`<div class="key-cell" data-key="${t[0]}">
        ${t[1].toString(16).toUpperCase()}
        <sup>${t[0].toUpperCase()}</sup>
      </div>`).join("");const ce=()=>{if(!g.cpu.drawFlag)return;g.cpu.drawFlag=!1;const t={w:y.width/g.display.columns,h:y.height/g.display.rows};g.highRes||(t.w*=2,t.h*=2),z.clearRect(0,0,y.width,y.height);for(let r=0;r<g.display.rows;r++)for(let n=0;n<g.display.columns;n++)z.fillStyle=g.display.getPixel(n,r)?"#6cf":"#000",z.fillRect(n*t.w,r*t.h,t.w,t.h)};let f;const $=()=>{f==null||f();let t=requestAnimationFrame(function i(s){let d=16/(1e3/g.RATE);for(;d>0;)g.cpu.cycle(),d--;g.cpu.ticker(),g.cpu.soundTimer&&le.play(),ce(),t=requestAnimationFrame(i)});const r=i=>{g.keyboard.keyDown(i.key)&&L.querySelector(`[data-key=${i.key}]`).classList.add("active")},n=i=>{g.keyboard.keyUp(i.key)&&L.querySelector(`[data-key=${i.key}]`).classList.remove("active")};window.addEventListener("keydown",r),window.addEventListener("keyup",n),f=()=>{cancelAnimationFrame(t),window.removeEventListener("keydown",r),window.removeEventListener("keyup",n)}},K=async()=>{z.clearRect(0,0,y.width,y.height),g.reset(),f==null||f();const t=W[+O.value];E("desc").innerHTML=t.desc;const r=await ne(t);g.loadRom(r),console.log("load done."),$()},Z=()=>{g.toggleRunning()?$():f==null||f()};E("start").addEventListener("click",K);E("pause").addEventListener("click",Z);O.addEventListener("keydown",t=>t.preventDefault());window.addEventListener("keydown",t=>{switch(t.code){case"Space":return t.preventDefault(),K();case"KeyP":return Z()}});["touchstart","mousedown"].forEach(t=>{L.addEventListener(t,r=>{const n=r.target;if(!n.classList.contains("key-cell"))return;const i=n.dataset.key;g.keyboard.keyDown(i)})});["mouseup","touchend","touchcancel"].forEach(t=>{L.addEventListener(t,()=>{g.keyboard.reset()})});
